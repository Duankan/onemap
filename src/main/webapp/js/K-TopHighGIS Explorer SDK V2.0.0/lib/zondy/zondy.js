!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ktop=e():t.ktop=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){i(2),i(3),i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11)},function(t,e){var i={Layers:{},Service:{}};"undefined"!=typeof window&&window.L&&(window.L.zondy=i),window.ZondyLeaflet=i,i.ZondyClass=L.Class.extend({initialize:function(t){t=L.setOptions(this,t)},toJSON:function(){return L.Util.toJSON(this,["_initHooksCalled","_initHooks"],null,!0)}})},function(t,e){ZondyLeaflet.CDisplayStyle=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.AnnSizeFixed=void 0!==e.AnnSizeFixed&&e.AnnSizeFixed,this.DriverQuality=void 0!==e.DriverQuality?e.DriverQuality:0,this.DynProjFlag=void 0!==e.DynProjFlag&&e.DynProjFlag,this.FollowScale=void 0!==e.FollowScale&&e.FollowScale,this.LinPenWidFixed=void 0!==e.LinPenWidFixed&&e.LinPenWidFixed,this.LinSizeFixed=void 0!==e.LinSizeFixed&&e.LinSizeFixed,this.PntPenWidFixed=void 0!==e.PntPenWidFixed&&e.PntPenWidFixed,this.PntSizeFixed=void 0!==e.PntSizeFixed&&e.PntSizeFixed,this.RegPenWidFixed=void 0!==e.RegPenWidFixed&&e.RegPenWidFixed,this.RegSizeFixed=void 0!==e.RegSizeFixed&&e.RegSizeFixed,this.ShowCoordPnt=void 0!==e.ShowCoordPnt&&e.ShowCoordPnt,this.ShowElemRect=void 0!==e.ShowElemRect&&e.ShowElemRect,this.ShowStyle=void 0!==e.ShowStyle?e.ShowStyle:null,this.SymbleShow=void 0!==e.SymbleShow&&e.SymbleShow}}),ZondyLeaflet.CDisplayStyleExtend=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.Index=void 0!==e.Index?e.Index:0,this.SymbleShow=void 0!==e.SymbleShow&&e.SymbleShow,this.LinPenWidFixed=void 0!==e.LinPenWidFixed&&e.LinPenWidFixed,this.LinSizeFixed=void 0!==e.LinSizeFixed&&e.LinSizeFixed,this.PntPenWidFixed=void 0!==e.PntPenWidFixed&&e.PntPenWidFixed,this.PntSizeFixed=void 0!==e.PntSizeFixed&&e.PntSizeFixed,this.RegPenWidFixed=void 0!==e.RegPenWidFixed&&e.RegPenWidFixed,this.RegSizeFixed=void 0!==e.RegSizeFixed&&e.RegSizeFixed,this.AnnSizeFixed=void 0!==e.AnnSizeFixed&&e.AnnSizeFixed,this.FollowScale=void 0!==e.FollowScale&&e.FollowScale,this.ShowCoordPnt=void 0!==e.ShowCoordPnt&&e.ShowCoordPnt,this.ShowElemRect=void 0!==e.ShowElemRect&&e.ShowElemRect,this.DriverQuality=void 0!==e.DriverQuality?e.DriverQuality:0,this.DynProjFlag=void 0!==e.DynProjFlag&&e.DynProjFlag}}),ZondyLeaflet.DynShowStyle=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.Alpha=void 0!==e.Alpha?e.Alpha:0,this.BugSpare=void 0!==e.BugSpare&&e.BugSpare,this.CustomRender=void 0!==e.CustomRender&&e.CustomRender,this.CustomRenderPath=void 0!==e.CustomRenderPath?e.CustomRenderPath:null,this.DirectionLineClr=void 0!==e.DirectionLineClr?e.DirectionLineClr:0,this.DynNoteFlag=void 0!==e.DynNoteFlag&&e.DynNoteFlag,this.DynNoteInfo=void 0!==e.DynNoteInfo?e.DynNoteInfo:null,this.IsShowArc=void 0!==e.IsShowArc?e.IsShowArc:0,this.ISShowLineDirection=void 0!==e.ISShowLineDirection&&e.ISShowLineDirection,this.LineInfo=void 0!==e.LineInfo?e.LineInfo:null,this.MaxScale=void 0!==e.MaxScale?e.MaxScale:0,this.MinScale=void 0!==e.MinScale?e.MinScale:0,this.ShowCoordPnt=void 0!==e.ShowCoordPnt&&e.ShowCoordPnt,this.SpareLineInfo=void 0!==e.SpareLineInfo?e.SpareLineInfo:null,this.SparePointInfo=void 0!==e.SparePointInfo?e.SparePointInfo:null,this.SpareRegInfo=void 0!==e.SpareRegInfo?e.SpareRegInfo:null,this.SymbleScale=void 0!==e.SymbleScale?e.SymbleScale:0}}),ZondyLeaflet.CLineInfo=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.Color=void 0!==e.Color&&null!=e.Color?e.Color:1,this.LinStyleID=void 0!==e.LinStyleID&&null!=e.LinStyleID?e.LinStyleID:1,this.LinStyleID2=void 0!==e.LinStyleID2&&null!=e.LinStyleID2?e.LinStyleID2:0,this.LinWidth=void 0!==e.LinWidth&&null!=e.LinWidth?e.LinWidth:1,this.Xscale=void 0!==e.Xscale&&null!=e.Xscale?e.Xscale:1,this.Yscale=void 0!==e.Yscale&&null!=e.Yscale?e.Yscale:1}}),ZondyLeaflet.CPointInfo=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.Angle=void 0!==e.Angle&&null!=e.Angle?e.Angle:1,this.Color=void 0!==e.Color&&null!=e.Color?e.Color:1,this.SymHeight=void 0!==e.SymHeight&&null!=e.SymHeight?e.SymHeight:1,this.SymID=void 0!==e.SymID&&null!=e.SymID?e.SymID:1,this.SymWidth=void 0!==e.SymWidth&&null!=e.SymWidth?e.SymWidth:1}}),ZondyLeaflet.CRegionInfo=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.EndColor=void 0!==e.EndColor&&null!=e.EndColor?e.EndColor:1,this.FillColor=void 0!==e.FillColor&&null!=e.FillColor?e.FillColor:1,this.FillMode=void 0!==e.FillMode&&null!=e.FillMode?e.FillMode:0,this.OutPenWidth=void 0!==e.OutPenWidth&&null!=e.OutPenWidth?e.OutPenWidth:1,this.PatAngle=void 0!==e.PatAngle&&null!=e.PatAngle?e.PatAngle:1,this.PatColor=void 0!==e.PatColor&&null!=e.PatColor?e.PatColor:1,this.PatHeight=void 0!==e.PatHeight&&null!=e.PatHeight?e.PatHeight:1,this.PatID=void 0!==e.PatID&&null!=e.PatID?e.PatID:1,this.PatWidth=void 0!==e.PatWidth&&null!=e.PatWidth?e.PatWidth:1}}),ZondyLeaflet.CDynNoteInfo=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.Angle=void 0!==e.Angle?e.Angle:0,this.Backclr=void 0!==e.Backclr?e.Backclr:0,this.Backexp=void 0!==e.Backexp?e.Backexp:0,this.Bold=void 0!==e.Bold?e.Bold:0,this.FieldName=void 0!==e.FieldName?e.FieldName:null,this.FontAngle=void 0!==e.FontAngle?e.FontAngle:0,this.FontColor=void 0!==e.FontColor?e.FontColor:0,this.FontSize=void 0!==e.FontSize?e.FontSize:0,this.FontStyle=void 0!==e.FontStyle?e.FontStyle:0,this.Ifnt=void 0!==e.Ifnt?e.Ifnt:0,this.Ifnx=void 0!==e.Ifnx?e.Ifnx:ZondyLeaflet.Enum.FontShape.Positive,this.IsFilled=void 0!==e.IsFilled&&e.IsFilled,this.IsHzpl=void 0!==e.IsHzpl&&e.IsHzpl,this.IsOvprnt=void 0!==e.IsOvprnt&&e.IsOvprnt,this.LabelLevel=void 0!==e.LabelLevel?e.LabelLevel:0,this.LableType=void 0!==e.LableType?e.LableType:null,this.Offsetx=void 0!==e.Offsetx?e.Offsetx:0,this.Offsety=void 0!==e.Offsety?e.Offsety:0,this.Space=void 0!==e.Space?e.Space:0,this.StrikeThrough=void 0!==e.StrikeThrough?e.StrikeThrough:0,this.UnderLine=void 0!==e.UnderLine?e.UnderLine:0}}),ZondyLeaflet.DynNoteLableType=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.PntInfo=void 0!==e.PntInfo&&null!=e.PntInfo?e.PntInfo:null,this.LinInfo=void 0!==e.LinInfo&&null!=e.LinInfo?e.LinInfo:null,this.RegInfo=void 0!==e.RegInfo&&null!=e.RegInfo?e.RegInfo:null}}),ZondyLeaflet.LabelLinInfo=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.ClientOutLabel=void 0!==e.ClientOutLabel&&null!=e.ClientOutLabel&&e.ClientOutLabel,this.DistFromLine=void 0!==e.DistFromLine&&null!=e.DistFromLine?e.DistFromLine:0,this.FromLineConstrain=void 0!==e.FromLineConstrain&&null!=e.FromLineConstrain?e.FromLineConstrain:0,this.Interval=void 0!==e.Interval&&null!=e.Interval?e.Interval:0,this.LinType=void 0!==e.LinType&&null!=e.LinType?e.LinType:0,this.Repeat=void 0!==e.Repeat&&null!=e.Repeat?e.Repeat:0,this.SpreadType=void 0!==e.SpreadType&&null!=e.SpreadType?e.SpreadType:null}}),ZondyLeaflet.LablePntInfo=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.Ang=void 0!==e.Ang&&null!=e.Ang?e.Ang:null,this.ClientOutLabel=void 0!==e.ClientOutLabel&&null!=e.ClientOutLabel&&e.ClientOutLabel,this.Distance=void 0!==e.Distance&&null!=e.Distance?e.Distance:0,this.EightDirLableType=void 0!==e.EightDirLableType&&null!=e.EightDirLableType?e.EightDirLableType:null,this.PntType=void 0!==e.PntType&&null!=e.PntType?e.PntType:0}}),ZondyLeaflet.LabelRegInfo=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.ClientOutLabel=void 0!==e.ClientOutLabel&&null!=e.ClientOutLabel&&e.ClientOutLabel,this.LabelMiniRegion=void 0!==e.LabelMiniRegion&&null!=e.LabelMiniRegion?e.LabelMiniRegion:0,this.MayPlaceOutside=void 0!==e.MayPlaceOutside&&null!=e.MayPlaceOutside?e.MayPlaceOutside:0,this.MiniRegionArea=void 0!==e.MiniRegionArea&&null!=e.MiniRegionArea?e.MiniRegionArea:0,this.Offset=void 0!==e.Offset&&null!=e.Offset?e.Offset:0,this.RegType=void 0!==e.RegType&&null!=e.RegType?e.RegType:0}})},function(t,e){ZondyLeaflet.Tangram=ZondyLeaflet.ZondyClass.extend({initialize:function(t){},setByOL:function(t){return null},toString:function(){return""},getGeometryType:function(){},Trim:function(t,e){var i;return i=t.replace(/(^\s+)|(\s+$)/g,""),"g"==e.toLowerCase()&&(i=i.replace(/\s/g,"")),i}}),ZondyLeaflet.Point2D=ZondyLeaflet.Tangram.extend({x:null,y:null,initialize:function(t,e,i){this.x=void 0!==t?t:null,this.y=void 0!==e?e:null;var n=i||{};this.nearDis=void 0!==n.nearDis?parseFloat(n.nearDis):null},setByOL:function(t){this.x=t.x,this.y=t.y},toString:function(){if(null==this.x||null==this.y)return"";var t=this.x+","+this.y;return void 0!==this.nearDis&&(t+=";"+this.nearDis),t},getGeometryType:function(){return"point"}}),ZondyLeaflet.Circle=ZondyLeaflet.Tangram.extend({point:null,radius:null,initialize:function(t,e){this.point=t,this.radious=e},setByOL:function(t){var e=t.components,i=new OpenLayers.Geometry.LinearRing(e[0].components),n=i.getCentroid(),o=Math.abs(e[0].components[0].x-n.x);this.point=new Zondy.Object.Point2D(n.x,n.y),this.radious=o},toString:function(){return null==this.point||null==this.radious?"":this.point.x+","+this.point.y+","+this.radious},getGeometryType:function(){return"Circle"}}),ZondyLeaflet.PolyLine=ZondyLeaflet.Tangram.extend({pointArr:null,initialize:function(t,e){var i=void 0!==e?e:{};this.nearDis=void 0!==i.nearDis&&null!=i.nearDis?parseFloat(i.nearDis):null,this.pointArr=void 0!==t&&null!=t&&Array.isArray(t)?t:new Array},setByOL:function(t){var e,i=t.components.length;for(e=0;e<i;e++)this.pointArr[e]=new Zondy.Object.Point2D(t.components[e].x,t.components[e].y)},toString:function(){if(null==this.pointArr||0==this.pointArr.length)return"";var t,e="";for(t=0;t<this.pointArr.length;t++)e+=this.pointArr[t].x+","+this.pointArr[t].y+",";return e.substring(0,e.length-1)},getGeometryType:function(){return"Line"}}),ZondyLeaflet.Rectangle=ZondyLeaflet.Tangram.extend({xmin:0,xmax:0,ymin:0,ymax:0,initialize:function(t,e,i,n,o){this.xmin=t,this.xmax=i,this.ymin=e,this.ymax=n},setByOL:function(t){this.xmin=t.components[0].components[3].x,this.ymin=t.components[0].components[3].y,this.xmax=t.components[0].components[1].x,this.ymax=t.components[0].components[1].y},toString:function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},getGeometryType:function(){return"Rect"},convertToBound:function(){return[this.xmin,this.ymin,this.ymax,this.xmax]}}),ZondyLeaflet.Polygon=ZondyLeaflet.Tangram.extend({pointArr:null,initialize:function(t){this.pointArr=new Array,void 0!=t&&(this.pointArr=t)},setByOL:function(t){if(void 0!==t&&null!=t)for(var e=t.getLinearRing(0),i=e.getCoordinates(),n=i.length,o=0;o<n;o++)this.pointArr[o]=new Zondy.Object.Point2D(i[o][0],i[o][1])},toString:function(){if(null==this.pointArr||0==this.pointArr.length)return"";for(var t="",e=0;e<this.pointArr.length;e++)t+=this.pointArr[e].x+","+this.pointArr[e].y+",";return t.substring(0,t.length-1)},getGeometryType:function(){return"Polygon"}}),ZondyLeaflet.MultiPolygon=ZondyLeaflet.Tangram.extend({pointArr:null,initialize:function(t){this.polygonArr=void 0!==t&&null!=t&&Array.isArray(t)?t:new Array},setByOL:function(t){if(void 0!==t&&null!=t)for(var e=t.getLinearRing(0),i=e.getCoordinates(),n=i.length,o=0;o<n;o++)this.pointArr[o]=new Zondy.Object.Point2D(i[o][0],i[o][1])},toString:function(){if(void 0===this.polygonArr||null==this.polygonArr||0==this.polygonArr.length)return"";for(var t="",e=0;e<this.polygonArr.length;e++)t+=this.polygonArr[e].toString()+";";return t.substring(0,t.length-1)},getGeometryType:function(){return"MultiPolygon"}})},function(t,e){ZondyLeaflet.Layers.Doc=L.NonTiledLayer.extend({defaultOptions:{layers:"",f:"png",filters:null,style:null,proj:null,guid:L.Util.newGuid()},options:{crs:null,pane:"tilePane",opacity:1,uppercase:!1},initialize:function(t,e){if(e=L.extend({},e),!L.Util.isNull(e))for(var i in this.defaultOptions)L.Util.isNull(e[i])||(this.defaultOptions[i]=e[i],delete e[i]);this._ip=L.Util.isNull(e.ip)?"127.0.0.1":e.ip,this._port=L.Util.isNull(e.port)?"6163":e.port,this._baseUrl="http://"+this._ip+":"+this._port+"/igs/rest/mrms/",this._layerName=t,L.setOptions(this,e)},onAdd:function(t){this._map=t,this._crs=this.options.crs||t.options.crs,L.NonTiledLayer.prototype.onAdd.call(this,t)},getImageUrl:function(t,e,i){var n=this._crs.project(t.getNorthWest()),o=this._crs.project(t.getSouthEast()),l=(this._wmsUrl,l=[n.x,o.y,o.x,n.y].join(",")),s={w:e,h:i,bbox:l};this.defaultOptions.style=L.Util.isNull(this.defaultOptions.style)?null:L.Util.toJSON(style,["_initHooksCalled","_initHooks"],null,!0);var r={};for(var a in this.defaultOptions)null!=this.defaultOptions[a]&&(r[a]=this.defaultOptions[a]);return this._url=this._baseUrl+"docs/"+this._layerName+L.Util.getParamString(L.Util.extend({},r,s)),this._url},setParams:function(t,e){return L.extend(this.wmsParams,t),e||this.redraw(),this},setFilters:function(t){this.defaultOptions.filters=t,this.redraw()},setShowLayers:function(t){null!=t&&""!=t&&(this.defaultOptions.layers="show:"+t,this.redraw())},setHideLayers:function(t){null!=t&&""!=t&&(this.defaultOptions.layers="hide:"+t,this.redraw())},setIncludeLayers:function(t){null!=t&&""!=t&&(this.defaultOptions.layers="include:"+t,this.redraw())},setExcludeLayers:function(t){null!=t&&""!=t&&(this.defaultOptions.layers="exclude:"+t,this.redraw())},setStyle:function(t){null!=t&&(this.defaultOptions.style=L.Util.toJSON(t,["_initHooksCalled","_initHooks"],null,!0),this.redraw())},setGuid:function(t){null!=t&&""!=L.Util.trim(t)&&(this.defaultOptions.guid=L.Util.trim(t))},getGuid:function(){return this.defaultOptions.guid},fitBounds:function(t){var e=this._baseUrl+"info/"+this._layerName+"?f=json",i={url:e,success:this._callback.bind(this),fail:this._errback.bind(this),type:"GET"};L.extend(i,t),L.ajax(i)},_callback:function(t){if(null!=t){var e=JSON.parse(t);console.log([e.xMin,e.yMin],[e.xMax,e.yMax]),null!=e&&null!=e.xMin&&e.xMin!=e.xMax&&this._map.fitBounds([[e.yMin,e.xMin],[e.yMax,e.xMax]])}},_errback:function(t){return null}}),ZondyLeaflet.doc=ZondyLeaflet.Layers.Doc,ZondyLeaflet.Layers.doc=function(t,e){return new ZondyLeaflet.Layers.Doc(t,e)},ZondyLeaflet.doc=function(t,e){return new ZondyLeaflet.Layers.Doc(t,e)}},function(t,e){ZondyLeaflet.Layers.VectorLayer=L.NonTiledLayer.extend({defaultOptions:{gdbps:null,f:"png",filters:null,style:null,guid:L.Util.newGuid()},options:{crs:null,pane:"tilePane",opacity:1,uppercase:!1},initialize:function(t,e){if(e=L.extend({},e),!L.Util.isNull(e))for(var i in this.defaultOptions)L.Util.isNull(e[i])||(this.defaultOptions[i]=e[i],delete e[i]);this._ip=L.Util.isNull(e.ip)?"127.0.0.1":e.ip,this._port=L.Util.isNull(e.port)?"6163":e.port,this._baseUrl="http://"+this._ip+":"+this._port+"/igs/rest/mrms/layers",this._gdbps=t,null!=!L.Util.isNull(t)&&(this.defaultOptions.gdbps=t.join(",")),L.setOptions(this,e)},onAdd:function(t){this._map=t,this._crs=this.options.crs||t.options.crs,L.NonTiledLayer.prototype.onAdd.call(this,t)},getImageUrl:function(t,e,i){var n=this._crs.project(t.getNorthWest()),o=this._crs.project(t.getSouthEast()),l=(this._wmsUrl,l=[n.x,o.y,o.x,n.y].join(",")),s={w:e,h:i,bbox:l},r={};for(var a in this.defaultOptions)null!=this.defaultOptions[a]&&(r[a]=this.defaultOptions[a]);return this._url=this._baseUrl+L.Util.getParamString(L.Util.extend({},r,s)),this._url},setParams:function(t,e){return L.extend(this.wmsParams,t),e||this.redraw(),this},setFilters:function(t){this.defaultOptions.filters=t,this.redraw()},setStyle:function(t){null!=t&&(this.defaultOptions.style=L.toJSON(t,["_initHooksCalled","_initHooks"],null,!0),this.redraw())},setGuid:function(t){null!=t&&""!=L.Util.trim(t)&&(this.defaultOptions.guid=L.Util.trim(t))},getGuid:function(){return this.defaultOptions.guid},fitBounds:function(t){var e=0;if((L.Util.isNull(t)||L.Util.isNull(t.layerIndex))&&(e=0),L.Util.isNull(this._gdbps))return void console.log("图层路径不能为空!");var i="http://"+this._ip+":"+this._port+"/igs/rest/mrcs/layerinfo?f=json&gdbpUrl="+this._gdbps[e],n={url:i,success:this._callback.bind(this),fail:this._errback.bind(this),type:"GET"};L.extend(n,t),L.ajax(n)},_callback:function(t){if(null!=t){var e=JSON.parse(t);console.log([e.xMin,e.yMin],[e.xMax,e.yMax]),null!=e&&e.Range&&null!=e.Range.xmin&&e.Range.xmin!=e.Range.xmax&&this._map.fitBounds([[e.Range.ymin,e.Range.xmin],[e.Range.ymax,e.Range.xmax]])}},_errback:function(t){return null}}),ZondyLeaflet.vectorLayer=ZondyLeaflet.Layers.VectorLayer,ZondyLeaflet.Layers.vectorLayer=function(t,e){return new ZondyLeaflet.Layers.VectorLayer(t,e)},ZondyLeaflet.vectorLayer=function(t,e){return new ZondyLeaflet.Layers.VectorLayer(t,e)}},function(t,e){ZondyLeaflet.Layers.TileInfo=L.Class.extend({defalutTileInfo:{ip:"127.0.0.1",port:"6163"},initialize:function(t,e){var i=void 0!==e?e:{};this.defalutTileInfo.name=t;for(var n in i)this.defalutTileInfo[n]=i[n]},getTileInfo:function(t,e,i){var n="http://"+this.defalutTileInfo.ip+":"+this.defalutTileInfo.port+"/igs/rest/mrms/info/"+this.defalutTileInfo.name+"?f=json",o="2.0";void 0!=this.defalutTileInfo.version&&null!=this.defalutTileInfo.version&&(o=this.defalutTileInfo.version),n=n+"&v="+o,this.callback=t,this.errback=e;var l={url:n,success:this._callback.bind(this),fail:this._errback.bind(this),type:"GET"};L.extend(l,i),L.ajax(l)},_callback:function(t){var e=JSON.parse(t);e.ip=this.defalutTileInfo.ip,e.port=this.defalutTileInfo.port,e.latLngBounds=new L.LatLngBounds(new L.LatLng(e.yMin,e.xMin),new L.LatLng(e.yMax,e.xMax)),e.center=L.latLng((e.yMax+e.yMin)/2,(e.xMax+e.xMin)/2),this.callback(e)},_errback:function(t){alert("请求瓦片元数据信息失败，请检查服务或地址！")}}),ZondyLeaflet.tileInfo=ZondyLeaflet.Layers.TileInfo,ZondyLeaflet.Layers.tileInfo=function(t,e){return new ZondyLeaflet.Layers.TileInfo(t,e)},ZondyLeaflet.tileInfo=function(t,e){return new ZondyLeaflet.Layers.TileInfo(t,e)}},function(t,e){ZondyLeaflet.Layers.TileLayer=L.TileLayer.extend({_isRequestInfo:!1,initialize:function(t,e){e=L.extend({},e),"object"==typeof t?(L.Util.isNull(e)||(t=L.obj.assign(t,e)),e=t,this._tileName=e.name):(this._tileName=t,this._isRequestInfo=!0),this._ip=L.Util.isNull(e.ip)?"127.0.0.1":e.ip,this._port=L.Util.isNull(e.port)?"6163":e.port,this.opt_options=e,L.Util.isNull(this.opt_options.tileWidth)||(this.opt_options.tileSize=this.opt_options.tileWidth),L.Util.isNull(e.zoomOffset)||(this._isZoomOffset=!0),L.setOptions(this,this.opt_options),this.isNativeZoom=void 0==this.opt_options.isNativeZoom||this.opt_options.isNativeZoom},onAdd:function(t){if(this._map=t,this._isRequestInfo){var e=!this.opt_options.async||this.opt_options.async,i={ip:this._ip,port:this._port,async:e};this.opt_options.proxy&&(i.proxy=this.opt_options.proxy);new L.zondy.tileInfo(this._tileName,i).getTileInfo(this._callback.bind(this),this._fail.bind(this))}else this.setDisplayBounds(),L.TileLayer.prototype.onAdd.call(this,t),this.setMinMaxNativeZoom()},_callback:function(t){this.opt_options=L.extend(t,this.opt_options),this.setDisplayBounds(),L.TileLayer.prototype.onAdd.call(this,map),L.Util.isNull(this.loadTileInfo)||this.fitBounds(),this.setMinMaxNativeZoom()},_fail:function(t){alert("获取瓦片数据信息失败!")},setMinMaxNativeZoom:function(){if(this.isNativeZoom&&!L.Util.isNull(this.opt_options.startLevel)&&!L.Util.isNull(this.opt_options.endLevel)){var t=this._map.getMapZoomByResolution(this.opt_options.resolutions[this.opt_options.startLevel]);-1!=t&&(this.options.minNativeZoom=t),this.options.minZoom=void 0!=this.opt_options.minZoom?this.opt_options.minZoom:this._map.getMinZoom();var e=this._map.getMapZoomByResolution(this.opt_options.resolutions[this.opt_options.endLevel]);-1!=e&&(this.options.maxNativeZoom=e),this.options.maxZoom=void 0!=this.opt_options.maxZoom?this.opt_options.maxZoom:this._map.getMaxZoom()}},setDisplayBounds:function(t){t?this.options.bounds=t:this.opt_options.latLngBounds&&(this.options.bounds=this.opt_options.latLngBounds)},getTileUrl:function(t,e){var i=this._map;crs=i.options.crs;var n=t.z;if(this._isZoomOffset)n=t.z+this.opt_options.zoomOffset;else if(!L.Util.isNull(this.opt_options.resolutions)){var o=this._map.getNearestZoom(this.opt_options.resolutions,t.z);o==t.z?n=o:o>=0&&(n=o)}var l=t.y;return!("lefttop"!=this.opt_options.originType.toLowerCase()&&"lefttop_tianditu"!=this.opt_options.originType.toLowerCase()&&(l=-(t.y+1),t.x<0||t.x>=Math.pow(2,t.z)||l>=Math.pow(2,t.z)||l<0))&&"http://"+this._ip+":"+this._port+"/igs/rest/mrms/tile/"+this._tileName+"/"+n+"/"+l+"/"+t.x},setParams:function(t,e){return L.extend(this.wmtsParams,t),e||this.redraw(),this},fitBounds:function(){L.Util.isNull(this.opt_options)||L.Util.isNull(this.opt_options.latLngBounds)?this.loadTileInfo=!0:this._map.fitBounds(this.opt_options.latLngBounds)}}),ZondyLeaflet.tileLayer=ZondyLeaflet.Layers.TileLayer,ZondyLeaflet.Layers.tileLayer=function(t,e){return new ZondyLeaflet.Layers.TileLayer(t,e)},ZondyLeaflet.tileLayer=function(t,e){return new ZondyLeaflet.Layers.TileLayer(t,e)}},function(t,e){ZondyLeaflet.FeatureJSON=L.Class.extend({defaultStyle:{clickable:!1,color:"#FF0000",dashArray:null,fill:!0,fillColor:null,fillOpacity:.2,lineCap:null,lineJoin:null,noClip:!1,opacity:.5,smoothFactor:1,stroke:!0,weight:2},initialize:function(){},read:function(t,e){var i=void 0!==e?e:{};if(this.featureLayer=void 0!=i.layer?i.layer:new L.FeatureGroup,this.style=void 0!=i.style?i.style:this.defaultStyle,this.markerStyle=void 0!=i.markerStyle?i.markerStyle:null,void 0===t)return null;var n=null;return n="string"==typeof t?JSON.parse(t):t,null!==n?this.parseVectors(n):void 0},parseVectors:function(t){if(void 0===t||void 0===t.SFEleArray)return null;if(0==t.SFEleArray.length)return null;for(var e=new Array,i=0,n=t.SFEleArray.length;i<n;i++){var o=t.SFEleArray[i],l=this.parseAttribute(t.AttStruct,o.AttValue),s=this.parseGeometry(o.fGeom,o.ftype);e[i]=s,s.feature={type:"Feature",fid:o.FID.toString(),properties:l},this.featureLayer.addLayer(s)}return this.featureLayer},parseBound:function(t){return void 0===t?null:[t.xmin,t.ymin,t.xmax,t.ymax]},parseAttribute:function(t,e){if(void 0===t||void 0===e)return null;if(t.FldName.length!=e.length)return null;for(var i=new Object,n=0,o=t.FldName.length;n<o;n++)i[t.FldName[n]]=e[n];return i},parseGeometry:function(t,e){var i=null;switch("Unknow"==e&&(e=t.PntGeom.length>0?1:t.LinGeom.length>0?2:3),e){case 1:i=this.parseGPoint(t.PntGeom);break;case 2:i=this.parseGLine(t.LinGeom);break;case 3:i=this.parseGRegion(t.RegGeom)}return i},parseGRegion:function(t){if(void 0===t||void 0===t.length||0==t.length)return null;for(var e=0,i=new Array,n=0;n<t.length;n++){var o=t[n];if(void 0===o||void 0===o.Rings)return null;for(var l=o.Rings.length,s=0,r=l;s<r;s++){for(var a=o.Rings[s],d=new Array,u=a.Arcs[0].Dots,h=0,y=u.length;h<y;h++)d[h]=new L.LatLng(u[h].y,u[h].x);i[e++]=d}}return new L.Polygon(i,this.style)},parseGLine:function(t){if(void 0===t||void 0===t.length||0==t.length)return null;var e=[];if(!t)return null;if(0===t.length)return null;for(var i=0,n=t.length;i<n;i++){for(var o=new Array,l=t[i].Line.Arcs[0].Dots,s=0,r=l.length;s<r;s++)o[s]=new L.LatLng(l[s].y,l[s].x);e[i]=o}return null!=this.style&&(this.style.fill=!1),new L.Polyline(e,this.style)},parseGPoint:function(t){if(void 0===t||void 0===t.length||0==t.length)return null;for(var e=[],i=null,n=0,o=t.length;n<o;n++)i=t[n].Dot,latlng=new L.LatLng(i.y,i.x),e.push(new L.Marker(latlng,this.markerStyle));return new L.FeatureGroup(e)}}),ZondyLeaflet.featureJSON=function(){return new ZondyLeaflet.FeatureJSON}},function(t,e){ZondyLeaflet.QueryFeatureRule=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.CompareRectOnly=void 0!==e.CompareRectOnly&&"boolean"==typeof e.CompareRectOnly&&e.CompareRectOnly,this.EnableDisplayCondition=void 0!==e.EnableDisplayCondition&&"boolean"==typeof e.EnableDisplayCondition&&e.EnableDisplayCondition,this.MustInside=void 0!==e.MustInside&&"boolean"==typeof e.MustInside&&e.MustInside,this.Intersect=void 0===e.Intersect||"boolean"!=typeof e.Intersect||e.Intersect}}),ZondyLeaflet.QueryFeatureStruct=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.IncludeAttribute=void 0===e.IncludeAttribute||"boolean"!=typeof e.IncludeAttribute||e.IncludeAttribute,this.IncludeGeometry=void 0!==e.IncludeGeometry&&"boolean"==typeof e.IncludeGeometry&&e.IncludeGeometry,this.IncludeWebGraphic=void 0!==e.IncludeWebGraphic&&"boolean"==typeof e.IncludeWebGraphic&&e.IncludeWebGraphic}}),ZondyLeaflet.QueryParameterBase=ZondyLeaflet.ZondyClass.extend({initialize:function(t){var e=void 0!==t?t:{};this.geometry=void 0!==e.geometry?e.geometry:null,this.where=void 0!==e.where?e.where:null,this.rule=void 0!==e.rule?e.rule:null,this.objectIds=void 0!==e.objectIds?e.objectIds:null,this.pageIndex=void 0!==e.pageIndex?e.pageIndex:0,this.pageCount=void 0!==e.pageCount?e.pageCount:20,this.resultFormat=void 0!==e.resultFormat?e.resultFormat:"json",this.struct=void 0!==e.struct?e.struct:new ZondyLeaflet.QueryFeatureStruct,this.orderField=void 0!==e.orderField?e.orderField:null,this.isAsc=void 0!==e.isAsc&&e.isAsc}}),ZondyLeaflet.QueryParameter=ZondyLeaflet.QueryParameterBase.extend({initialize:function(t){ZondyLeaflet.QueryParameterBase.prototype.initialize.call(this,t)},getParameterURL:function(){var t="";return null!=this.geometry&&(t+="geometry="+this.geometry.toString(),t+="&geometryType="+this.geometry.getGeometryType()),t+="&page="+this.pageIndex.toString(),t+="&pageCount="+this.pageCount.toString(),t+="&f="+this.resultFormat,null!=this.struct&&(t+="&structs="+this.struct.toJSON()),null!=this.where&&(t+="&where="+this.where),null!=this.rule&&(t+="&rule="+this.rule.toJSON()),null!=this.objectIds&&(t+="&objectIds="+this.objectIds),null!=this.orderField&&(t+="&orderField="+this.orderField),null!=this.isAsc&&(t+="&isAsc="+this.isAsc),t},getParameterObject:function(){var t={};return t.f=this.resultFormat,null!=this.struct&&(t.structs=this.struct.toJSON()),null!=this.objectIds?(t.objectIds=this.objectIds,t):(t.page=this.pageIndex.toString(),t.pageCount=this.pageCount.toString(),null!=this.geometry&&(t.geometry=this.geometry.toString(),t.geometryType=this.geometry.getGeometryType()),null!=this.where&&(t.where=this.where),null!=this.rule&&(t.rule=this.rule.toJSON()),null!=this.orderField&&(t.orderField=this.orderField),null!=this.isAsc&&(t.isAsc=this.isAsc),t)}}),ZondyLeaflet.QueryByLayerParameter=ZondyLeaflet.QueryParameter.extend({initialize:function(t){var e=void 0!==t?t:{};ZondyLeaflet.QueryParameterBase.prototype.initialize.call(this,e),this.gdbp=void 0!==e.gdbp?encodeURI(e.gdbp):null},getParameterURL:function(){return ZondyLeaflet.QueryParameter.prototype.getParameterURL.apply(this)+"&gdbp="+this.gdbp},getParameterObject:function(){var t=ZondyLeaflet.QueryParameter.prototype.getParameterObject.apply(this);return t.gdbp=this.gdbp,t}})},function(t,e){ZondyLeaflet.Service.QueryTask=L.Class.extend({initialize:function(t){var e=void 0!==t?t:{};this.ip=void 0!==e.ip?e.ip:"127.0.0.1",this.port=void 0!==e.port?e.port:"6163",this._queryParameter=void 0!==e.queryParameter?e.queryParameter:null,this.name=void 0!==e.name?e.name:null,this._type=void 0!==e.type?e.type:"GET",this._queryLayers=void 0!==e.queryLayers?e.queryLayers:"0",this._baseUrl=void 0!==e.baseUrl?e.baseUrl:"/igs/rest/mrfs/"},execute:function(t,e){if(this.callback=t,this.errback=e,this._getQueryUrl(),"POST"==this._type){var i=null;null!=this._queryParameter&&(i=this._queryParameter.getParameterObject()),L.ajax({url:this._url,success:this._callback.bind(this),fail:this._errback.bind(this),type:this._type,data:L.Util.toJSON(i)})}else null!=this._queryParameter&&(this._url=this._url+"?"+this._queryParameter.getParameterURL()),L.ajax({url:this._url,success:this._callback.bind(this),fail:this._errback.bind(this),type:this._type})},_getQueryUrl:function(){this._queryParameter instanceof ZondyLeaflet.QueryByLayerParameter?this._url="http://"+this.ip+":"+this.port+this._baseUrl+"layer/query":this._url="http://"+this.ip+":"+this.port+this._baseUrl+"docs/"+this.name+"/0/"+this._queryLayers+"/query"},_callback:function(t){var e=t;null!=this._queryParameter&&null!=this._queryParameter.resultFormat&&"json"==this._queryParameter.resultFormat.toLowerCase()&&(e=JSON.parse(t)),this.callback(e)},_errback:function(t){this.errback(t)}}),ZondyLeaflet.queryTask=ZondyLeaflet.Service.QueryTask,ZondyLeaflet.Service.queryTask=function(t,e){return new ZondyLeaflet.Service.QueryTask(t,e)},ZondyLeaflet.queryTask=function(t,e){return new ZondyLeaflet.Service.QueryTask(t,e)}}])});